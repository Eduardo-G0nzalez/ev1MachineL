# DVC Pipeline Configuration
# Versions and tracks datasets, features, models, and metrics

stages:
  # ============================================
  # FASE 1: Preparación de Datos
  # ============================================
  prepare:
    cmd: kedro run --pipeline=data_preparation_pipeline
    deps:
      - data/01_raw/movies.csv
      - data/01_raw/releases.csv
      - data/01_raw/genres.csv
      - data/01_raw/countries.csv
      - src/letterboxdml/pipelines/data_preparation_pipeline.py
    outs:
      - data/02_intermediate/releases_clean.csv
      - data/02_intermediate/countries_clean.csv
      - data/02_intermediate/genres_clean.csv
      - data/02_intermediate/min_release.csv
      - data/03_primary/final_df.csv
      - data/03_primary/integrated_data.csv
      - data/03_primary/final_df_us_2000s_2010s.parquet

  # ============================================
  # FASE 2: Feature Engineering
  # ============================================
  features:
    cmd: kedro run --pipeline=eda_pipeline
    deps:
      - data/02_intermediate/releases_clean.csv
      - data/02_intermediate/countries_clean.csv
      - data/02_intermediate/genres_clean.csv
      - data/03_primary/final_df.csv
      - src/letterboxdml/pipelines/eda_pipeline.py
    outs:
      - data/05_model_input/classification_dataset.csv
      - data/05_model_input/regression_dataset.csv

  # ============================================
  # FASE 3: Entrenar Modelos de Clasificación
  # ============================================
  train_classification:
    cmd: kedro run --pipeline=classification_pipeline
    deps:
      - data/05_model_input/classification_dataset.csv
      - src/letterboxdml/pipelines/ml_modeling_pipeline.py
    outs:
      - data/06_models/classification_results.pkl
      - data/06_models/classification_metrics.pkl
    metrics:
      - data/06_models/classification_metrics.json:
          cache: false

  # ============================================
  # FASE 4: Entrenar Modelos de Regresión
  # ============================================
  train_regression:
    cmd: kedro run --pipeline=regression_pipeline
    deps:
      - data/05_model_input/regression_dataset.csv
      - src/letterboxdml/pipelines/ml_modeling_pipeline.py
    outs:
      - data/06_models/regression_results.pkl
      - data/06_models/regression_metrics.pkl
    metrics:
      - data/06_models/regression_metrics.json:
          cache: false

  # ============================================
  # FASE 5: Evaluar Modelos Supervisados
  # ============================================
  evaluate:
    cmd: kedro run --pipeline=ml_modeling_pipeline
    deps:
      - data/06_models/classification_results.pkl
      - data/06_models/regression_results.pkl
      - src/letterboxdml/pipelines/ml_modeling_pipeline.py
    outs:
      - data/07_model_output/comparison_report.md
      - data/07_model_output/final_metrics.pkl
    metrics:
      - data/07_model_output/final_metrics.json:
          cache: false

  # ============================================
  # FASE 6: Aprendizaje No Supervisado
  # ============================================
  unsupervised_learning:
    cmd: kedro run --pipeline=unsupervised_learning_pipeline
    deps:
      - data/05_model_input/regression_dataset.csv
      - src/letterboxdml/pipelines/unsupervised_learning/
    outs:
      - data/06_models/X_scaled.pkl
      - data/06_models/scaler_clustering.pkl
      - data/06_models/feature_cols_clustering.pkl
      - data/06_models/movie_indices.pkl
      - data/06_models/optimal_k_results.pkl
      - data/06_models/kmeans_results.pkl
      - data/06_models/dbscan_results.pkl
      - data/06_models/hierarchical_results.pkl
      - data/06_models/pca_results.pkl
      - data/06_models/tsne_results.pkl
      - data/06_models/umap_results.pkl
      - data/06_models/pca_biplot_data.pkl
      - data/07_model_output/clustering_comparison.csv
      - data/07_model_output/pca_loadings.csv
      - data/07_model_output/dim_reduction_comparison.csv
      - data/07_model_output/clustering_metrics.json
    metrics:
      - data/07_model_output/clustering_metrics.json:
          cache: false

